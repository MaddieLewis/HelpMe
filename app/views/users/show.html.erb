<div class="container mt-3">
  <% if @user == current_user %>
    <h2>Hello <%= @user.first_name %>!</h2>
  <% else %>
    <h2>Welcome to my page!</h2>
  <% end %>

  <div class="card-product ">
    <img src="<%= @user.profile_picture %>" alt="profile-avatar" class="align-self-center" style="height: 200px;">

    <div class="d-flex justify-content-between" style="width: 100%; height: 100%;">
      <div class="card-product-infos" style="align-self: center;">
        <h3 style="text-align: right;"> <%= @user.first_name %> <%= @user.last_name %> </h3>
        <p><%= @user.description %></p>
      </div>

      <div class="d-flex align-items-center justify-content-end" style="align-self: flex-end;">
        <% if @user == current_user %>
          <%= link_to "edit profile", edit_user_registration_path, class: "btn button-pink light-pink mb-2 mr-2" %>
          <%#= link_to "create new task", new_task_path, class: "btn button-pink" %>
        <% end %>
      </div>
    </div>
  </div>


  <% if @user == current_user %>
    <h3 class="mt-3">Your Tasks </h3>
    <% @user.tasks.each do |task| %>
      <div class="card-gd">
        <% if task.photo %>
          <img src="<%= task.photo %>" class="card-img-top" style="height:200px; background-size: cover; background-repeat: none; background-position: center;" alt="">
        <%else%>
          <img src="https://images.pexels.com/photos/1389103/pexels-photo-1389103.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260" class="card-img-top" style="height:200px; background-size: cover; background-repeat: none; background-position: center; background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3))" alt="">
        <% end %>
        <h3 class="task-title"><%= task.title %></h3>
        <!-- <p class="mt-3"><%#= task.description %></p> -->
        <p><%= task.category %></p>
        <p><%=  task.start_time.strftime("%dth %B") %></p>

        <% if task.booking_ids.count == 1 %>
          <h5>Your task has <%= task.booking_ids.count %> applicant awaiting your approval!</h5>
        <% elsif task.booking_ids.count > 1 %>
          <h5>Your task has <%= task.booking_ids.count %> applicants awaiting your approval!</h5>
        <% end %>

        <%= link_to "view task", task_path(task), class: "btn button-pink" %>

      </div>
    <% end %>

      <h3 class="mt-3">You have offered to help!</h3>
      <% @user.bookings.each do |booking| %>
        <div class="card-gd-profile">
          <div class="card-body">
            <div class="d-flex align-items-center">
              <img src="<%= User.find(booking.task.user_id).profile_picture %>" alt="profile-avatar" class="avatar-large align-self-center">
              <h3 class="ml-3"><%= User.find(booking.task.user_id).first_name %>'s Task</h3>
            </div>
            <h3 class="task-title mt-3"><%= booking.task.title %></h3>
            <p class="mt-3">Description: <%= booking.task.description %></p>
            <p>Category: <%= booking.task.category %></p>
            <p><%=  booking.time.strftime("%dth %B") %></p>
            <% if booking.status == "pending" %>
              <h5>this booking still needs to be confirmed by <%= User.find(booking.task.user_id).first_name %>.</h5>
            <% elsif booking.status == "confirmed" %>
              <h5><%= User.find(booking.task.user_id).first_name %> has approved your request to help!.</h5>
              <%= link_to "get in touch", User.find(booking.task.user_id).email, class: "btn button-pink" %>
            <% elsif booking.status == "declined"%>
              <h5><%= User.find(booking.task.user_id).first_name %> has found someone else to help.</h5>
            <% elsif booking.status == "cancelled"%>
              <h5><%= User.find(booking.task.user_id).first_name %> has cancelled this request.</h5>
            <% end %>
            <%= link_to "view booking", task_booking_path(booking.task, booking), class: "btn button-pink" %>
          </div>
        </div>
      <% end %>

    <% end %>

</div>
